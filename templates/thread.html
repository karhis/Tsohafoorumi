{% extends "layout.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}

{% from "_formhelpers.html" import render_field %}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">Etusivu</a></li>
    <li class="breadcrumb-item"><a href="/forum/{{ forum_id }}">{{ forum_name }}</a></li>
    <li class="breadcrumb-item"><a href="/subforum/{{ subforum_id }}">{{ subforum_name }}</a></li>
  </ol>
</nav>

{% if locked %}
<i class="gg-lock"></i>
{% endif %}

{% if session["mod"] %}
<form action="/delete" method="POST">
  <fieldset class="form-group">
    <input type="hidden" name="delete_id" value="{{ thread_id }}">
    <input type="hidden" name="delete_type" value="0">
    <button type="submit" class="btn btn-danger">Poista lanka</button>
  </fieldset>
</form>
{% if locked %}
<form action="/lock" method="POST">
  <fieldset class="form-group">
    <input type="hidden" name="lock_id" value="{{ thread_id }}">
    <input type="hidden" name="lock_type" value="0">
    <button type="submit" class="btn btn-success">Avaa lanka</button>
  </fieldset>
</form>
{% else %}
<form action="/lock" method="POST">
  <fieldset class="form-group">
    <input type="hidden" name="lock_id" value="{{ thread_id }}">
    <input type="hidden" name="lock_type" value="1">
    <button type="submit" class="btn btn-warning">Lukitse lanka</button>
  </fieldset>
</form>
{% endif %}
{% endif %}

<br>

{% if session.username and session["banned"]==False %}
<form action="/thank" method="POST">
  <input type="hidden" name="thread_id" value="{{ thread_id }}">
  <input type="hidden" name="thank_type" value="0">
  <input type="submit" value="Tykkää langasta">
</form>
{% endif %}

<h2>{{ title[0] }}</h2>

{% for reply in messages %}
<div class="jumbotron">
  <div class="row">
    <div class="col-md-1 offset-md-1 mx-1 my-1">
      <p>{{ reply[4] }}</p>
      <br>
      <small>{{ reply[3].strftime("%Y-%m-%d %H:%M:%S") }}</small>
      <br>
      <small>Tykkäykset : {{ reply[6] }}</small>
    </div>
    <div class="col-sm-9 text-md-left ml-3 mt-3">
      <h4>{{ reply[1] }}</h4>
      <br>
      {% if reply[5] is not none %}
      <small>{{ reply[5] }}</small>
      <br>
      {% endif %}
      <br>
      {% if session.username and session["banned"]==False %}
      <form action="/thank" method="POST">
        <input type="hidden" name="message_id" value="{{ reply[0] }}">
        <input type="hidden" name="thank_type" value="1">
        <input type="submit" value="Tykkää viestistä">
      </form>
      {% if session["mod"] %}
      <form action="/delete" method="POST">
        <fieldset class="form-group">
          <input type="hidden" name="delete_id" value="{{ reply[0] }}">
          <input type="hidden" name="delete_type" value="1">
          <button type="submit" class="btn btn-danger">Poista viesti</button>
        </fieldset>
      </form>
      {% endif %}
      {% endif %}
    </div>
  </div>
</div>
{% endfor %}

<br>

<p>
{% if session.username and session["banned"]==False %}
  <b>Vastaa lankaan</b>
</p>
{% if locked %}
<fieldset disabled>
  <form action="/reply" method="POST" novalidate>
    <dl>
      {{ render_field(form.message) }}
    </dl>
    <input type="hidden" name="reply_type" value="0">
    <input type="hidden" name="thread_id" value="{{ thread_id }}">
    <input type="submit" value="Lanka on lukittu">
  </form>
</fieldset>
{% else %}
<form action="/reply" method="POST" novalidate>
  <dl>
    {{ render_field(form.message) }}
  </dl>
  <input type="hidden" name="reply_type" value="0">
  <input type="hidden" name="thread_id" value="{{ thread_id }}">
  <input type="submit" value="Lähetä">
</form>
{% endif %}
{% endif %}

{% endblock %}