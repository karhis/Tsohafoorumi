{% extends "layout.html" %}
{% block title %}Etusivu{% endblock %}
{% block content %}
{% if locked == 1 %} 
  <i class="gg-lock"></i>
{% endif %}
<h1>{{ title }}</h1>
{% if session["mod"] %}
<form action="/delete" method="POST">
  <fieldset>
    <fieldset class="form-group">
    <input type="hidden" name="delete_id" value="{{ id }}">
    <input type="hidden" name="delete_type" value="0">
    <button type="submit" class="btn btn-danger">POISTA LANKA</button>
    </fieldset>
  </fieldset>
</form>
{% if locked == 1 %}
<form action="/lock" method="POST">
  <fieldset>
    <fieldset class="form-group">
    <input type="hidden" name="lock_id" value="{{ id }}">
    <input type="hidden" name="lock_type" value="0">
    <button type="submit" class="btn btn-success">Avaa lanka</button>
    </fieldset>
  </fieldset>
</form>
{% else %}
<form action="/lock" method="POST">
  <fieldset>
    <fieldset class="form-group">
    <input type="hidden" name="lock_id" value="{{ id }}">
    <input type="hidden" name="lock_type" value="1">
    <button type="submit" class="btn btn-warning">Lukitse lanka</button>
    </fieldset>
  </fieldset>
</form>
{% endif %}
{% endif %}
<br>
{% if session.username %}
<form action="/thank" method="POST">
<input type="hidden" name="thread_id" value="{{ id }}">
<input type="hidden" name="message_id" value="0">
<input type="submit" value="Tykkää langasta">
</form>
{% endif %}
{% for reply in messages %}
<br><p>
<div class="jumbotron">
    <h2 class="display-3">{{ reply[1] }}</h2>
    <p class="lead">{{ reply[4] }} </p>
    <hr class="my-4">
    <p> {{ reply[3] }} </p>
    <hr class="my-4">
    {% set ms = namespace(likes=0) %}
    {% for thank in thanks %}
    {% if thank[1] == reply[0]: %}
      {% set ms.likes = thank[2] %}
    {% endif %}
    {% endfor %}
    <p>{{ ms.likes }}</p>
    {% if session.username %}
      <form action="/thank" method="POST">
      <input type="hidden" name="message_id" value="{{ reply[0] }}">
      <input type="hidden" name="thread_id" value="0">
      <input type="submit" value="Tykkää viestistä">
      </form> 
      {% if session["mod"] %}
        <form action="/delete" method="POST">
          <fieldset>
            <fieldset class="form-group">
            <input type="hidden" name="delete_id" value="{{ reply[0] }}">
            <input type="hidden" name="delete_type" value="1">
            <button type="submit" class="btn btn-danger">POISTA VIESTI</button>
            </fieldset>
          </fieldset>
        </form>
      {% endif %}
    {% endif %}
</div>
</p>
{% endfor %}
<br>
<p>
{% if session.username %}
Vastaa lankaan
</p>
{% if locked == 1 %}
  <fieldset disabled>
    <form action="/reply" method="POST">
      Viesti: 
      <input type="text" name="message">
      <input type="hidden" name="reply_type" value="0">
      <input type="hidden" name="thread_id" value="{{ id }}">
      <input type="submit" value="Lanka on lukittu">
      </form>
  </fieldset>
{% else %}
<form action="/reply" method="POST">
  Viesti: 
  <input type="text" name="message">
  <input type="hidden" name="reply_type" value="0">
  <input type="hidden" name="thread_id" value="{{ id }}">
  <input type="submit" value="Lähetä">
  </form>
{% endif %}
{% endif %}
{% endblock %}