{% extends "layout.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
{% if locked %} 
  <i class="gg-lock"></i>
{% endif %}
{% if session["mod"] %}
  <form action="/delete" method="POST">
    <fieldset class="form-group">
    <input type="hidden" name="delete_id" value="{{ id }}">
    <input type="hidden" name="delete_type" value="0">
    <button type="submit" class="btn btn-danger">POISTA LANKA</button>
    </fieldset>
  </form>
  {% if locked %}
    <form action="/lock" method="POST">
      <fieldset class="form-group">
        <input type="hidden" name="lock_id" value="{{ id }}">
        <input type="hidden" name="lock_type" value="0">
        <button type="submit" class="btn btn-success">Avaa lanka</button>
      </fieldset>
    </form>
  {% else %}
    <form action="/lock" method="POST">
      <fieldset class="form-group">
        <input type="hidden" name="lock_id" value="{{ id }}">
        <input type="hidden" name="lock_type" value="1">
        <button type="submit" class="btn btn-warning">Lukitse lanka</button>
      </fieldset>
    </form>
  {% endif %}
{% endif %}
<br>
{% if session.username and session["banned"]==False %}
  <form action="/thank" method="POST">
    <input type="hidden" name="thread_id" value="{{ id }}">
    <input type="hidden" name="thank_type" value="0">
    <input type="submit" value="Tykkää langasta">
  </form>
{% endif %}
<h2>{{ title }}</h2>
{% for reply in messages %}
  <div class="jumbotron">
    <div class="row">
      <div class="col-md-1 offset-md-1 mx-1 my-1">
        <p>{{ reply[4] }}</p>
      </div>
      <div class="col-sm-9 text-md-left ml-3 mt-3">
        <h3>{{ reply[1] }}</h3>
        <br>
        {% set ms = namespace(likes=0) %}
        {% for thank in thanks %}
          {% if thank[1] == reply[0]: %}
            {% set ms.likes = thank[2] %}
          {% endif %}
        {% endfor %}
        <small>{{ reply[3].strftime("%Y-%m-%d %H:%M:%S") }}</small>
        <br>
        <small>Tykkäykset : {{ ms.likes }}</small>
        <br>
        {% if session.username and session["banned"]==False %}
          <form action="/thank" method="POST">
            <input type="hidden" name="message_id" value="{{ reply[0] }}">
            <input type="hidden" name="thank_type" value="1">
            <input type="submit" value="Tykkää viestistä">
          </form> 
          {% if session["mod"] %}
            <form action="/delete" method="POST">
              <fieldset class="form-group">
                <input type="hidden" name="delete_id" value="{{ reply[0] }}">
                <input type="hidden" name="delete_type" value="1">
                <button type="submit" class="btn btn-danger">POISTA VIESTI</button>
              </fieldset>
            </form>
          {% endif %}
        {% endif %}
      </div>
    </div>
  </div>
{% endfor %}
<br>
<p>
{% if session.username and session["banned"]==False %}
  Vastaa lankaan
  </p>
  {% if locked %}
    <fieldset disabled>
      <form action="/reply" method="POST">
        Viesti: 
        <input type="text" name="message">
        <input type="hidden" name="reply_type" value="0">
        <input type="hidden" name="thread_id" value="{{ id }}">
        <input type="submit" value="Lanka on lukittu">
        </form>
    </fieldset>
  {% else %}
    <form action="/reply" method="POST">
      Viesti: 
      <input type="text" name="message">
      <input type="hidden" name="reply_type" value="0">
      <input type="hidden" name="thread_id" value="{{ id }}">
      <input type="submit" value="Lähetä">
    </form>
  {% endif %}
{% endif %}
{% endblock %}